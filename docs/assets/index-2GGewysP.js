import{j as e,r as n}from"./index-DVqOL6h7.js";import{A as G}from"./AudioSource-j2eT5cpn.js";import{I as o,C as j,B as h}from"./config-BBgi9drT.js";import{c as p}from"./cn-DPK3Nycl.js";const H=({className:a,...c})=>{const l=o.loading;return e.jsx("div",{className:p("flex items-center justify-center animate-spin",a),...c,children:e.jsx(l,{})})},J=({duration:a,current_progress:c,buffered:l,color:s,...i})=>{const x=a>0?c/a*100:0,y=a>0?l/a*100:0;return e.jsxs("div",{className:p("relative w-60 h-2 bg-gray-300 rounded overflow-hidden",i.className),children:[e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gray-400 rounded transition-all duration-200",style:{width:`${y}%`}}),e.jsx("div",{className:"absolute top-0 left-0 h-full rounded transition-all duration-200",style:{width:`${x}%`,backgroundColor:s||j.primary}}),e.jsx("input",{type:"range",className:"absolute top-0 left-0 w-full h-full opacity-0 cursor-pointer",min:0,max:a||1,value:c||0,onChange:d=>{var g;return(g=i.onChange)==null?void 0:g.call(i,d)},...i})]})};function K({track:a,...c}){const{title:l,artist:s,thumbnail:i}=a;return!l&&!s&&!i?null:e.jsxs("div",{...c,className:p("flex flex-row items-center gap-2",c.className),children:[i&&e.jsx("img",{src:i,alt:`${l} by ${s}`,className:"w-32 h-32 rounded-full"}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[l&&e.jsx("h1",{className:"text-2xl font-bold",children:l}),s&&e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[s.thumbnail&&s.url?e.jsx("a",{href:s.url,target:"_blank",rel:"noreferrer",className:"hover:underline underline-offset-2",children:e.jsx("img",{src:s.thumbnail,alt:s.name,className:"w-8 h-8 rounded-full"})}):s.thumbnail&&e.jsx("img",{src:s.thumbnail,alt:s.name,className:"w-8 h-8 rounded-full"}),e.jsx("div",{className:"flex flex-col items-center gap-1",children:s.url?e.jsx("a",{href:s.url,target:"_blank",rel:"noreferrer",children:s.name}):e.jsx("span",{children:s.name})})]})]})]})}function Q({volume:a,onVolumeChnge:c,className:l,color:s,...i}){return e.jsx("input",{type:"range",min:0,max:1,step:.01,value:a,onChange:x=>c(parseFloat(x.target.value)),className:p("h-1 w-20 appearance-none rounded-full bg-inherit/50","range-slider:h-2 range-slider:rounded-full progress-input",l),style:{backgroundColor:`linear-gradient(to right, ${s||j.primary} ${a*100}%, ${s||j.primary} 0%)`,border:`2px solid ${s||j.primary}`},...i})}function re({track:a,size:c=200,autoplay:l=!1,showTrackInfo:s=!1,showNextPrevControls:i=!1,showProgress:x=!0,showVolume:y=!0,audioRef:d,onNext:g,onPrev:T,color:P=j.primary,...w}){const[f,E]=n.useState(!1),[S,v]=n.useState(!1),[m,b]=n.useState(.25),[I,L]=n.useState(0),[O,$]=n.useState(0),[D,N]=n.useState(0),[r,U]=n.useState(null);d||(d=n.useRef(r)),n.useEffect(()=>{r?r.addEventListener("canplaythrough",()=>{E(!0)}):U(d.current)},[]);const V=n.useCallback(()=>{if(!(!f||!r))try{r.play(),v(!0)}catch(t){console.error(t),v(!1)}},[f]),k=n.useCallback(()=>{!f||!r||(r.pause(),v(!1))},[f]),A=n.useCallback(t=>{r&&(r.volume=t.currentTarget.volume,b(t.currentTarget.volume))},[]),F=n.useCallback(()=>{r&&(r.volume!==0?(r.volume=0,b(0)):(r.volume=.25,b(m)))},[r,m]),B=n.useCallback(t=>{const u=t.currentTarget;if(u.duration>0){for(let C=0;C<u.buffered.length;C++)if(u.buffered.start(u.buffered.length-1-C)<u.currentTime){L(u.buffered.end(u.buffered.length-1-C));break}}},[]),_=n.useCallback(t=>{N(t.currentTarget.currentTime),B(t)},[B]),z=n.useCallback(t=>{$(t.currentTarget.duration)},[]),M=n.useCallback(t=>{t.currentTarget.volume=m,E(!0)},[]),{src:W}=a,q=t=>{const u=parseFloat(t.currentTarget.value);N(u),r&&(r.currentTime=u)};return n.useEffect(()=>{l&&f&&r&&v(!0)},[]),n.useEffect(()=>{if(!r)return;const t=()=>N(r.currentTime),u=()=>{r.buffered.length>0&&L(r.buffered.end(r.buffered.length-1))};return r.addEventListener("timeupdate",t),r.addEventListener("progress",u),r.addEventListener("loadedmetadata",()=>$(r.duration)),()=>{r.removeEventListener("timeupdate",t),r.removeEventListener("progress",u)}},[]),e.jsxs("div",{...w,className:p("flex flex-col items-center gap-4 relative",w.className),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("audio",{ref:d,onCanPlay:M,onTimeUpdate:_,onDurationChange:z,onVolumeChange:A,onPause:k,autoPlay:l,preload:"auto",children:e.jsx(G,{src:W})}),e.jsxs("div",{className:"flex flex-col gap-2 items-center z-30",children:[s&&e.jsx(K,{track:a}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[f?!S&&!l?e.jsx(h,{onClick:V,children:e.jsx(o.play,{})}):l&&S?e.jsx(h,{onClick:k,children:e.jsx(o.pause,{})}):e.jsx(h,{onClick:k,children:e.jsx(o.pause,{})}):e.jsx(H,{}),y&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{onClick:F,children:m===0?e.jsx(o.volumeOff,{}):m<.5?e.jsx(o.volumeDown,{}):e.jsx(o.volumeUp,{})}),e.jsx(Q,{size:c,color:P,volume:m,onVolumeChnge:t=>{r&&(r.volume=t,b(t))}})]}),i&&g&&T&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{onClick:T,children:e.jsx(o.skipPrevious,{})}),e.jsx(h,{onClick:g,children:e.jsx(o.skipNext,{})})]})]})]})]}),x&&e.jsx(J,{color:P,duration:O,current_progress:D,buffered:I,onChange:q})]})}export{re as P};
