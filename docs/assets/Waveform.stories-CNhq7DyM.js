import{r as f,j as a}from"./index-CIT5xxdx.js";import{c as j}from"./cn-C63oow18.js";import{P as v}from"./index-B7x9lXsh.js";import{C as S}from"./config-BVESd2G5.js";import"./dialog-DnumWtkX.js";import"./AudioSource-D2kEpvTn.js";function L(e){e&&(e.width=e.clientWidth*window.devicePixelRatio,e.height=e.clientHeight*window.devicePixelRatio)}function b({analyser:e,canvas:t,canvasContext:i,dataArray:u,bufferLength:s,color:d}){if(!i)return;i.clearRect(0,0,t.width,t.height),e.getByteFrequencyData(u),i.fillStyle=d;const c=t.height,l=Math.ceil(t.width/s)*2.5;let m=0;for(let n=0;n<s;n++){const w=u[n]/255*c;i.fillRect(m,c-w,l,w),m+=l+1}}function z({analyserData:e,color:t,size:i,...u}){const{analyser:s,bufferLength:d,dataArray:c}=e,l=f.useRef(null),m=(w,x,A)=>{const r=l.current;if(!r||!w)return;const g=r.getContext("2d"),p=()=>{var o;requestAnimationFrame(p),r.width=((o=l.current)==null?void 0:o.width)||r.clientWidth,b({analyser:w,canvas:r,canvasContext:g,dataArray:A,bufferLength:x,color:t})};p()};function n(){L(l.current)}return f.useEffect(()=>(m(s,d,c),i||window.addEventListener("resize",n),()=>{window.removeEventListener("resize",n)}),[c,s,d,t]),a.jsx("canvas",{ref:l,width:i||400,height:i||400,style:{position:"absolute",color:t,zIndex:0,...u.style},...u})}function R(e,t,i,u){if(!e||!t)return null;i.current||(i.current=t.createMediaElementSource(e));const s=t.createAnalyser();return s.fftSize=u,i.current.connect(s),s.connect(t.destination),{analyser:s,getFrequencyData:()=>{const d=s.frequencyBinCount,c=new Uint8Array(d);return s.getByteFrequencyData(c),c}}}function h({track:e,size:t=500,fftSize:i=4096,autoplay:u=!1,showTrackInfo:s=!1,showVolume:d=!1,showProgress:c=!0,color:l=S.primary,...m}){const[n,w]=f.useState(null),[x,A]=f.useState(null),r=f.useRef(null);f.useEffect(()=>{r.current&&(r.current.src=e.src)},[e.src]);const g=f.useRef(null),p=()=>{if(!r.current){console.warn("🚨 Audio ref is not ready yet.");return}try{const o=n??new AudioContext;if(n||w(o),!o)throw new Error("AudioContext is null");o.state==="suspended"&&o.resume(),g.current||(g.current=o.createMediaElementSource(r.current));const E=R(r.current,o,g,i);E&&A(E.analyser)}catch(o){console.error("❌ Failed to initialize AudioContext:",o)}};return f.useEffect(()=>{r.current||(r.current=new Audio(e.src),r.current.load())},[e.src]),f.useEffect(()=>{const o=()=>{n?n.state==="suspended"&&n.resume():p()};return window.addEventListener("click",o),()=>{window.removeEventListener("click",o),n==null||n.close()}},[n]),a.jsx("div",{...m,className:j("flex gap-2 items-center justify-center w-full max-w-[400px] relative rounded-md bg-transparent",m.className),children:a.jsxs("div",{className:"relative w-full h-[100px]",children:[x&&a.jsx(z,{analyserData:{analyser:x,bufferLength:x.frequencyBinCount,dataArray:new Uint8Array(x.frequencyBinCount)},color:l,width:t,height:t,style:{position:"absolute",inset:0,width:"100%",height:"100%",opacity:.75,pointerEvents:"none",zIndex:0}}),a.jsx(v,{track:e,audioRef:r,autoplay:u,showTrackInfo:s,showProgress:c,showVolume:d,size:t})]})})}const H={title:"Waveform",component:h},y={src:"./dreamy-guitar-loop.mp3",title:"Dreamy Guitar Loop"},I=()=>a.jsx(h,{track:y}),T=()=>a.jsx(h,{track:y,style:{width:100,height:40}}),P=()=>a.jsx(h,{track:y,style:{width:1e3,height:400}}),M=()=>a.jsx(h,{track:y,showTrackInfo:!1}),G=()=>a.jsx(h,{track:y,color:"#ff0000"}),N=()=>a.jsx(h,{track:y,fftSize:128}),O=()=>a.jsx(h,{track:y,fftSize:16384});typeof window<"u"&&window.document&&window.document.createElement&&document.documentElement.setAttribute("data-storyloaded","");export{G as CustomColor,I as Default,O as HigherFFTSize,P as Large,N as LowerFFTSize,M as NoTrackInfo,T as Small,H as default};
