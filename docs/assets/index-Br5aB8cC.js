import{j as e,r as s}from"./index-DNBgkSAg.js";import{A as G}from"./AudioSource-C5sWUNeE.js";import{I as o,C as j,B as g}from"./config-Bp8s_Tfg.js";import{c as p}from"./cn-DMRvDxO3.js";const H=({className:n,...c})=>{const u=o.loading;return e.jsx("div",{className:p("flex items-center justify-center animate-spin",n),...c,children:e.jsx(u,{})})},J=({duration:n,current_progress:c,buffered:u,color:t,...l})=>{const m=n>0?c/n*100:0,C=n>0?u/n*100:0;return e.jsxs("div",{className:p("relative w-60 h-2 bg-gray-300 rounded overflow-hidden",l.className),children:[e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gray-400 rounded transition-all duration-200",style:{width:`${C}%`}}),e.jsx("div",{className:"absolute top-0 left-0 h-full rounded transition-all duration-200",style:{width:`${m}%`,backgroundColor:t||j.primary}}),e.jsx("input",{type:"range",className:"absolute top-0 left-0 w-full h-full opacity-0 cursor-pointer",min:0,max:n||1,value:c||0,onChange:d=>{var h;return(h=l.onChange)==null?void 0:h.call(l,d)},...l})]})};function K({track:n,...c}){const{title:u,artist:t,thumbnail:l}=n;return!u&&!t&&!l?null:e.jsxs("div",{...c,className:p("flex flex-row items-center gap-2",c.className),children:[l&&e.jsx("img",{src:l,alt:`${u} by ${t}`,className:"w-32 h-32 rounded-full"}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[u&&e.jsx("h1",{className:"text-2xl font-bold",children:u}),t&&e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[t.thumbnail&&t.url?e.jsx("a",{href:t.url,target:"_blank",rel:"noreferrer",className:"hover:underline underline-offset-2",children:e.jsx("img",{src:t.thumbnail,alt:t.name,className:"w-8 h-8 rounded-full"})}):t.thumbnail&&e.jsx("img",{src:t.thumbnail,alt:t.name,className:"w-8 h-8 rounded-full"}),e.jsx("div",{className:"flex flex-col items-center gap-1",children:t.url?e.jsx("a",{href:t.url,target:"_blank",rel:"noreferrer",children:t.name}):e.jsx("span",{children:t.name})})]})]})]})}function Q({volume:n,onVolumeChnge:c,className:u,color:t,...l}){return e.jsx("input",{type:"range",min:0,max:1,step:.01,value:n,onChange:m=>c(parseFloat(m.target.value)),className:p("h-1 w-20 appearance-none rounded-full bg-inherit/50","range-slider:h-2 range-slider:rounded-full progress-input",u),style:{backgroundColor:`linear-gradient(to right, ${t||j.primary} ${n*100}%, ${t||j.primary} 0%)`,border:`2px solid ${t||j.primary}`},...l})}function re({track:n,size:c=200,autoplay:u=!1,showTrackInfo:t=!1,showNextPrevControls:l=!1,showProgress:m=!0,showVolume:C=!0,audioRef:d,onNext:h,onPrev:k,color:T=j.primary,...P}){const[x,w]=s.useState(!1),[B,y]=s.useState(!1),[f,v]=s.useState(.25),[I,E]=s.useState(0),[O,S]=s.useState(0),[D,N]=s.useState(0),[r,U]=s.useState(null);d||(d=s.useRef(r)),s.useEffect(()=>{r?r.addEventListener("canplaythrough",()=>{w(!0)}):U(d.current)},[]);const V=s.useCallback(()=>{if(!(!x||!r))try{r.play(),y(!0)}catch(a){console.error(a),y(!1)}},[x]),L=s.useCallback(()=>{!x||!r||(r.pause(),y(!1))},[x]),A=s.useCallback(a=>{r&&(r.volume=a.currentTarget.volume,v(a.currentTarget.volume))},[]),F=s.useCallback(()=>{r&&(r.volume!==0?(r.volume=0,v(0)):(r.volume=.25,v(f)))},[r,f]),$=s.useCallback(a=>{const i=a.currentTarget;if(i.duration>0){for(let b=0;b<i.buffered.length;b++)if(i.buffered.start(i.buffered.length-1-b)<i.currentTime){E(i.buffered.end(i.buffered.length-1-b));break}}},[]),_=s.useCallback(a=>{N(a.currentTarget.currentTime),$(a)},[$]),z=s.useCallback(a=>{S(a.currentTarget.duration)},[]),M=s.useCallback(a=>{a.currentTarget.volume=f,w(!0)},[]),{src:W}=n,q=a=>{const i=parseFloat(a.currentTarget.value);N(i),r&&(r.currentTime=i)};return s.useEffect(()=>{if(!r)return;const a=()=>N(r.currentTime),i=()=>{r.buffered.length>0&&E(r.buffered.end(r.buffered.length-1))};return r.addEventListener("timeupdate",a),r.addEventListener("progress",i),r.addEventListener("loadedmetadata",()=>S(r.duration)),()=>{r.removeEventListener("timeupdate",a),r.removeEventListener("progress",i)}},[]),e.jsxs("div",{...P,className:p("flex flex-col items-center gap-4 relative",P.className),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("audio",{ref:d,onCanPlay:M,onTimeUpdate:_,onDurationChange:z,onVolumeChange:A,onPause:L,autoPlay:u,preload:"auto",children:e.jsx(G,{src:W})}),e.jsxs("div",{className:"flex flex-col gap-2 items-center z-30",children:[t&&e.jsx(K,{track:n}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[x?B?e.jsx(g,{onClick:L,children:e.jsx(o.pause,{})}):e.jsx(g,{onClick:V,children:e.jsx(o.play,{})}):e.jsx(H,{}),C&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{onClick:F,children:f===0?e.jsx(o.volumeOff,{}):f<.5?e.jsx(o.volumeDown,{}):e.jsx(o.volumeUp,{})}),e.jsx(Q,{size:c,color:T,volume:f,onVolumeChnge:a=>{r&&(r.volume=a,v(a))}})]}),l&&h&&k&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{onClick:k,children:e.jsx(o.skipPrevious,{})}),e.jsx(g,{onClick:h,children:e.jsx(o.skipNext,{})})]})]})]})]}),m&&e.jsx(J,{color:T,duration:O,current_progress:D,buffered:I,onChange:q})]})}export{re as P};
