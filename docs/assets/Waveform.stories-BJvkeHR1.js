import{r as l,j as o}from"./index-DNBgkSAg.js";import{c as j}from"./cn-DMRvDxO3.js";import{P as v}from"./index-Br5aB8cC.js";import{C as S}from"./config-Bp8s_Tfg.js";import"./dialog-BlLKB11T.js";import"./AudioSource-C5sWUNeE.js";function L(e){e&&(e.width=e.clientWidth*window.devicePixelRatio,e.height=e.clientHeight*window.devicePixelRatio)}function b({analyser:e,canvas:t,canvasContext:i,dataArray:u,bufferLength:s,color:f}){if(!i)return;i.clearRect(0,0,t.width,t.height),e.getByteFrequencyData(u),i.fillStyle=f;const c=t.height,d=Math.ceil(t.width/s)*2.5;let h=0;for(let n=0;n<s;n++){const w=u[n]/255*c;i.fillRect(h,c-w,d,w),h+=d+1}}function z({analyserData:e,color:t,size:i,...u}){const{analyser:s,bufferLength:f,dataArray:c}=e,d=l.useRef(null),h=(w,x,A)=>{const r=d.current;if(!r||!w)return;const g=r.getContext("2d"),p=()=>{requestAnimationFrame(p),r.width=r.width,b({analyser:w,canvas:r,canvasContext:g,dataArray:A,bufferLength:x,color:t})};p()};function n(){L(d.current)}return l.useEffect(()=>(h(s,f,c),i||window.addEventListener("resize",n),()=>{window.removeEventListener("resize",n)}),[c,s,f,t]),o.jsx("canvas",{ref:d,width:i||400,height:i||400,style:{position:"absolute",color:t,zIndex:0,...u.style},...u})}function R(e,t,i,u){if(!e||!t)return null;i.current||(i.current=t.createMediaElementSource(e));const s=t.createAnalyser();return s.fftSize=u,i.current.connect(s),s.connect(t.destination),{analyser:s,getFrequencyData:()=>{const f=s.frequencyBinCount,c=new Uint8Array(f);return s.getByteFrequencyData(c),c}}}function m({track:e,size:t=500,fftSize:i=4096,autoplay:u=!1,showTrackInfo:s=!1,showVolume:f=!1,showProgress:c=!0,color:d=S.primary,...h}){const[n,w]=l.useState(null),[x,A]=l.useState(null),r=l.useRef(null);l.useEffect(()=>{r.current&&(r.current.src=e.src)},[e.src]);const g=l.useRef(null),p=()=>{if(!r.current){console.warn("ðŸš¨ Audio ref is not ready yet.");return}try{const a=n??new AudioContext;if(n||w(a),!a)throw new Error("AudioContext is null");a.state==="suspended"&&a.resume(),g.current||(g.current=a.createMediaElementSource(r.current));const E=R(r.current,a,g,i);E&&A(E.analyser)}catch(a){console.error("âŒ Failed to initialize AudioContext:",a)}};return l.useEffect(()=>{r.current||(r.current=new Audio(e.src),r.current.load())},[e.src]),l.useEffect(()=>{const a=()=>{n?n.state==="suspended"&&n.resume():p()};return window.addEventListener("click",a),()=>{window.removeEventListener("click",a),n==null||n.close()}},[n]),o.jsx("div",{...h,className:j("flex gap-2 items-center justify-center w-full max-w-[400px] relative rounded-md bg-transparent",h.className),children:o.jsxs("div",{className:"relative w-full h-[100px]",children:[x&&o.jsx(z,{analyserData:{analyser:x,bufferLength:x.frequencyBinCount,dataArray:new Uint8Array(x.frequencyBinCount)},color:d,width:t,height:t,style:{position:"absolute",inset:0,width:"100%",height:"100%",opacity:.75,pointerEvents:"none",zIndex:0}}),o.jsx(v,{track:e,audioRef:r,autoplay:u,showTrackInfo:s,showProgress:c,showVolume:f,size:t})]})})}const I={title:"Waveform",component:m},y={src:"./dreamy-guitar-loop.mp3",title:"Dreamy Guitar Loop"},T=()=>o.jsx(m,{track:y}),W=()=>o.jsx(m,{track:y,style:{width:100,height:40}}),P=()=>o.jsx(m,{track:y,style:{width:1e3,height:400}}),M=()=>o.jsx(m,{track:y,showTrackInfo:!1}),G=()=>o.jsx(m,{track:y,color:"#ff0000"}),N=()=>o.jsx(m,{track:y,fftSize:128}),O=()=>o.jsx(m,{track:y,fftSize:16384});typeof window<"u"&&window.document&&window.document.createElement&&document.documentElement.setAttribute("data-storyloaded","");export{G as CustomColor,T as Default,O as HigherFFTSize,P as Large,N as LowerFFTSize,M as NoTrackInfo,W as Small,I as default};
