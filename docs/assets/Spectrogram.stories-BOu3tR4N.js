import{r as f,j as n}from"./index-DNBgkSAg.js";import{c as L}from"./cn-DMRvDxO3.js";import{A as $}from"./AudioSource-C5sWUNeE.js";import"./dialog-BlLKB11T.js";function V({audioRef:o,width:j="100%",height:b="25%",fftSize:A=1024,minDecibels:z=-100,maxDecibels:v=-25,colorMap:d=["#111","#ff0000","#ffff00","#ffffff"],smoothingTimeConstant:P=.8,realTime:E=!0,logarithmicScale:D=!0,onFrameUpdate:p,fillStyle:x,loop:k,...S}){const i=f.useRef(null),y=f.useRef(null),w=f.useRef(null),[T,R]=f.useState(!1),[I,M]=f.useState(!1),N=()=>{var e;if(T){(e=o.current)==null||e.pause(),R(!1);return}if(o.current){if(!y.current){const t=new(window.AudioContext||window.webkitAudioContext),r=t.createAnalyser();y.current=t,w.current=r,r.fftSize=A,r.minDecibels=z,r.maxDecibels=v,r.smoothingTimeConstant=P,t.createMediaElementSource(o.current).connect(r),r.connect(t.destination)}y.current.state==="suspended"&&y.current.resume(),o.current.paused&&o.current.play(),k&&(o.current.loop=!0),R(t=>!t)}};return f.useEffect(()=>{if(!i.current||!o.current)return;const e=i.current,t=e.getContext("2d");if(!t)return;e.width=800,e.height=400;const r=(u,h,s)=>`#${u.slice(1).match(/.{2}/g).map((g,C)=>{const l=parseInt(g,16),B=parseInt(h.slice(1).match(/.{2}/g)[C],16);return Math.round(l+s*(B-l)).toString(16).padStart(2,"0")}).join("")}`,q=u=>{const s=u/255*(d.length-1),a=Math.floor(s),g=s-a,C=d[a],l=d[a+1]||C;return r(C,l,g)},F=()=>{if(!e||!t||!w.current)return;const u=w.current.frequencyBinCount,h=new Uint8Array(u);w.current.getByteFrequencyData(h),t.fillStyle=x||"rgba(0, 0, 0, 0.5)",t.fillRect(0,0,e.width,e.height);for(let s=0;s<u;s++){const a=h[s],g=a/255*e.height,C=e.height-g,l=e.width/u;t.fillStyle=q(a),t.fillRect(s*l,C,l,g)}requestAnimationFrame(F),p==null||p(h)};T&&F()},[d,x,T,p]),n.jsx("canvas",{onClick:()=>{N(),M(!0)},className:`border border-zinc-800/65 dark:border-zinc-500/65 rounded-md cursor-pointer backdrop:invert-50 ${!I&&"bg-zinc-700/50 animate-pulse hover:border-2 transition-all hover:bg-zinc-700/75 hover:animate-none"}`,ref:i,style:{width:j,height:b},...S})}function c({track:o,fftSize:j,width:b,height:A,minDecibels:z,maxDecibels:v,colorMap:d,smoothingTimeConstant:P,realTime:E,logarithmicScale:D,onFrameUpdate:p,loop:x,fillStyle:k,...S}){const i=f.useRef(new Audio);return n.jsxs("div",{...S,className:L("",S.className),children:[n.jsx("audio",{ref:i,children:n.jsx($,{src:o.src})}),i.current&&n.jsx(V,{audioRef:i,fftSize:j,width:b,height:A,minDecibels:z,maxDecibels:v,colorMap:d,smoothingTimeConstant:P,realTime:E,logarithmicScale:D,onFrameUpdate:p,loop:x,fillStyle:k})]})}const U={title:"Spectrogram",component:c},m={track:{src:"./dreamy-guitar-loop.mp3"}},tt=()=>n.jsx(c,{...m}),W={...m,width:400,height:200},et=()=>n.jsx(c,{...W}),_={...m,colorMap:["#222222","#555555","#eeeeee"]},nt=()=>n.jsx(c,{..._}),G={...m,fillStyle:"#ddd"},ot=()=>n.jsx(c,{...G}),H={...m,loop:!0},rt=()=>n.jsx(c,{...H}),J={...m,smoothingTimeConstant:.9},st=()=>n.jsx(c,{...J}),K={...m,fftSize:32},ct=()=>n.jsx(c,{...K});typeof window<"u"&&window.document&&window.document.createElement&&document.documentElement.setAttribute("data-storyloaded","");export{nt as CustomColorMap,ct as CustomFFTSize,ot as CustomFillStyle,et as CustomSize,st as CustomSmoothingTimeConstant,tt as Default,rt as Loop,U as default};
