import{r as f,j as n}from"./index-DVqOL6h7.js";import{c as N}from"./cn-DPK3Nycl.js";import{A as B}from"./AudioSource-j2eT5cpn.js";import"./dialog-dL2DTonU.js";function L({audioRef:o,width:j="100%",height:b="25%",fftSize:A=1024,minDecibels:z=-100,maxDecibels:v=-25,colorMap:d=["#111","#ff0000","#ffff00","#ffffff"],smoothingTimeConstant:P=.8,onFrameUpdate:p,fillStyle:x,loop:k,...S}){const i=f.useRef(null),y=f.useRef(null),w=f.useRef(null),[E,T]=f.useState(!1),[q,F]=f.useState(!1),I=()=>{var e;if(E){(e=o.current)==null||e.pause(),T(!1);return}if(o.current){if(!y.current){const t=new(window.AudioContext||window.webkitAudioContext),r=t.createAnalyser();y.current=t,w.current=r,r.fftSize=A,r.minDecibels=z,r.maxDecibels=v,r.smoothingTimeConstant=P,t.createMediaElementSource(o.current).connect(r),r.connect(t.destination)}y.current.state==="suspended"&&y.current.resume(),o.current.paused&&o.current.play(),k&&(o.current.loop=!0),T(t=>!t)}};return f.useEffect(()=>{if(!i.current||!o.current)return;const e=i.current,t=e.getContext("2d");if(!t)return;e.width=800,e.height=400;const r=(u,h,s)=>`#${u.slice(1).match(/.{2}/g).map((g,C)=>{const l=parseInt(g,16),M=parseInt(h.slice(1).match(/.{2}/g)[C],16);return Math.round(l+s*(M-l)).toString(16).padStart(2,"0")}).join("")}`,D=u=>{const s=u/255*(d.length-1),a=Math.floor(s),g=s-a,C=d[a],l=d[a+1]||C;return r(C,l,g)},R=()=>{if(!e||!t||!w.current)return;const u=w.current.frequencyBinCount,h=new Uint8Array(u);w.current.getByteFrequencyData(h),t.fillStyle=x||"rgba(0, 0, 0, 0.5)",t.fillRect(0,0,e.width,e.height);for(let s=0;s<u;s++){const a=h[s],g=a/255*e.height,C=e.height-g,l=e.width/u;t.fillStyle=D(a),t.fillRect(s*l,C,l,g)}requestAnimationFrame(R),p==null||p(h)};E&&R()},[d,x,E,p]),n.jsx("canvas",{onClick:()=>{I(),F(!0)},className:`border border-zinc-800/65 dark:border-zinc-500/65 rounded-md cursor-pointer backdrop:invert-50 ${!q&&"bg-zinc-700/50 animate-pulse hover:border-2 transition-all hover:bg-zinc-700/75 hover:animate-none"}`,ref:i,style:{width:j,height:b},...S})}function c({track:o,fftSize:j,width:b,height:A,minDecibels:z,maxDecibels:v,colorMap:d,smoothingTimeConstant:P,onFrameUpdate:p,loop:x,fillStyle:k,...S}){const i=f.useRef(new Audio);return n.jsxs("div",{...S,className:N("",S.className),children:[n.jsx("audio",{ref:i,children:n.jsx(B,{src:o.src})}),i.current&&n.jsx(L,{audioRef:i,fftSize:j,width:b,height:A,minDecibels:z,maxDecibels:v,colorMap:d,smoothingTimeConstant:P,onFrameUpdate:p,loop:x,fillStyle:k})]})}const Y={title:"Spectrogram",component:c},m={track:{src:"./dreamy-guitar-loop.mp3"}},Z=()=>n.jsx(c,{...m}),$={...m,width:400,height:200},U=()=>n.jsx(c,{...$}),V={...m,colorMap:["#222222","#555555","#eeeeee"]},tt=()=>n.jsx(c,{...V}),W={...m,fillStyle:"#ddd"},et=()=>n.jsx(c,{...W}),_={...m,loop:!0},nt=()=>n.jsx(c,{..._}),G={...m,smoothingTimeConstant:.9},ot=()=>n.jsx(c,{...G}),H={...m,fftSize:32},rt=()=>n.jsx(c,{...H});typeof window<"u"&&window.document&&window.document.createElement&&document.documentElement.setAttribute("data-storyloaded","");export{tt as CustomColorMap,rt as CustomFFTSize,et as CustomFillStyle,U as CustomSize,ot as CustomSmoothingTimeConstant,Z as Default,nt as Loop,Y as default};
