import{r as u,j as s}from"./index-BndVsEdy.js";import{c as j,C as v,P as S}from"./index-iwOgGpkd.js";function C(e){e&&(e.width=e.clientWidth*window.devicePixelRatio,e.height=e.clientHeight*window.devicePixelRatio)}function b({analyser:e,canvas:t,canvasContext:o,dataArray:l,bufferLength:r,color:d}){if(!o)return;o.clearRect(0,0,t.width,t.height),e.getByteFrequencyData(l),o.fillStyle=d;const c=t.height,f=Math.ceil(t.width/r)*2.5;let y=0;for(let n=0;n<r;n++){const h=l[n]/255*c;o.fillRect(y,c-h,f,h),y+=f+1}}function L({analyserData:e,color:t,size:o,...l}){const{analyser:r,bufferLength:d,dataArray:c}=e,f=u.useRef(null),y=(h,x,E)=>{const i=f.current;if(!i||!h)return;const g=i.getContext("2d"),A=()=>{requestAnimationFrame(A),i.width=i.width,b({analyser:h,canvas:i,canvasContext:g,dataArray:E,bufferLength:x,color:t})};A()};function n(){C(f.current)}return u.useEffect(()=>(y(r,d,c),o||window.addEventListener("resize",n),()=>{window.removeEventListener("resize",n)}),[c,r,d,t]),s.jsx("canvas",{ref:f,width:o||400,height:o||400,style:{position:"absolute",color:t,zIndex:0,...l.style},...l})}function R(e,t,o,l){if(!e||!t)return console.warn("âŒ Audio element or context is not available"),null;o.current?console.log("âœ… MediaElementAudioSourceNode already exists."):(console.log("ðŸŽ¤ Creating new MediaElementAudioSourceNode..."),o.current=t.createMediaElementSource(e));const r=t.createAnalyser();return r.fftSize=l,o.current.connect(r),r.connect(t.destination),console.log("ðŸ” Analyser Created:",r),{analyser:r,getFrequencyData:()=>{const d=r.frequencyBinCount,c=new Uint8Array(d);return r.getByteFrequencyData(c),c}}}function w({track:e,size:t=500,fftSize:o=4096,autoplay:l=!1,showTrackInfo:r=!1,showVolume:d=!1,showProgress:c=!0,color:f,...y}){const[n,h]=u.useState(null),[x,E]=u.useState(null),i=u.useRef(null);u.useEffect(()=>{i.current&&(i.current.src=e.src)},[e.src]);const g=u.useRef(null),A=()=>{if(!i.current){console.warn("ðŸš¨ Audio ref is not ready yet.");return}try{const a=n??new AudioContext;if(n||h(a),!a)throw new Error("AudioContext is null");a.state==="suspended"&&a.resume(),g.current||(g.current=a.createMediaElementSource(i.current));const p=R(i.current,a,g,o);p&&E(p.analyser)}catch(a){console.error("âŒ Failed to initialize AudioContext:",a)}};return u.useEffect(()=>{i.current||(i.current=new Audio(e.src),i.current.load())},[e.src]),u.useEffect(()=>{const a=()=>{n?n.state==="suspended"&&(console.log("â–¶ï¸ Resuming AudioContext..."),n.resume()):A()};return window.addEventListener("click",a),()=>{window.removeEventListener("click",a),n==null||n.close()}},[n]),s.jsx("div",{...y,className:j("flex gap-2 items-center justify-center w-full max-w-[400px] relative rounded-md bg-transparent",y.className),children:s.jsxs("div",{className:"relative w-full h-[100px]",children:[x&&s.jsx(L,{analyserData:{analyser:x,bufferLength:x.frequencyBinCount,dataArray:new Uint8Array(x.frequencyBinCount)},color:f||v.primary,width:t,height:t,style:{position:"absolute",inset:0,width:"100%",height:"100%",opacity:.75,pointerEvents:"none",zIndex:0}}),s.jsx(S,{track:e,audioRef:i,autoplay:l,showTrackInfo:r,showProgress:c,showVolume:d,size:t})]})})}const D={title:"Waveform",component:w},m={src:"/dreamy-guitar-loop.mp3",title:"Dreamy Guitar Loop"},q=()=>s.jsx(w,{track:m}),B=()=>s.jsx(w,{track:m,style:{width:100,height:40}}),H=()=>s.jsx(w,{track:m,style:{width:1e3,height:400}}),I=()=>s.jsx(w,{track:m,showTrackInfo:!1}),M=()=>s.jsx(w,{track:m,color:"#ff0000"}),T=()=>s.jsx(w,{track:m,fftSize:128}),W=()=>s.jsx(w,{track:m,fftSize:16384});typeof window<"u"&&window.document&&window.document.createElement&&document.documentElement.setAttribute("data-storyloaded","");export{M as CustomColor,q as Default,W as HigherFFTSize,H as Large,T as LowerFFTSize,I as NoTrackInfo,B as Small,D as default};
